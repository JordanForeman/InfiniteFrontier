window.app=window.app||{},app.Events={},app.Views={},app.Constants={DIRECTION_FORWARD:"forward",DIRECTION_FORWARD_LEFT:"forward-left",DIRECTION_LEFT:"left",DIRECTION_AWAY_LEFT:"away-left",DIRECTION_AWAY:"away",DIRECTION_AWAY_RIGHT:"away-right",DIRECTION_RIGHT:"right",DIRECTION_FORWARD_RIGHT:"forward-right",TILE_WIDTH:32},app.Controller={cursors:null,cursorPos:null,game:null,init:function(a){this.game=a,this.cursors=this.game.input.keyboard.createCursorKeys(),this.cursorPos=new Phaser.Plugin.Isometric.Point3,this.game.input.keyboard.addKeyCapture([Phaser.Keyboard.LEFT,Phaser.Keyboard.RIGHT,Phaser.Keyboard.UP,Phaser.Keyboard.DOWN,Phaser.Keyboard.SPACEBAR]);var b=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);return b.onDown.add(function(){app.Events.trigger("keypress","space")}),this},checkInputs:function(){var a=null,b=!1;this.cursors.up.isDown?(a="up",b=!0):this.cursors.down.isDown&&(a="down",b=!0),this.cursors.left.isDown?(a="left",b=!0):this.cursors.right.isDown&&(a="right",b=!0),b?app.Events.trigger("keypress",a):app.Events.trigger("no-keypress")}},app.Player={game:null,isoGroup:null,gameObject:null,speed:200,currentDirection:app.Constants.DIRECTION_FORWARD_LEFT,init:function(a,b){return this.game=a,this.isoGroup=b,this.gameObject=this.game.add.isoSprite(128,128,128,"character",this.currentDirection,this.isoGroup),this.gameObject.tint=8830938,this.gameObject.anchor.set(.5),a.physics.isoArcade.enable(this.gameObject),this.gameObject.body.collideWorldBounds=!0,this.addListeners(),this.gameObject},addListeners:function(){app.Events.on("keypress",this.inputHandler.bind(this)),app.Events.on("keypress",this.updateCurrentDirection.bind(this)),app.Events.on("no-keypress",this.noKeyPressHandler.bind(this))},noKeyPressHandler:function(){this.gameObject.body.velocity.y=0,this.gameObject.body.velocity.x=0},updateCurrentDirection:function(a){this.currentDirection;"up"==a&&(this.currentDirection=app.Constants.DIRECTION_AWAY_RIGHT),"down"==a&&(this.currentDirection=app.Constants.DIRECTION_FORWARD_LEFT),"left"==a&&(this.currentDirection=app.Constants.DIRECTION_AWAY_LEFT),"right"==a&&(this.currentDirection=app.Constants.DIRECTION_FORWARD_RIGHT),this.gameObject.setFrame(this.currentDirection)},inputHandler:function(a){"space"==a&&(this.gameObject.body.velocity.z=300),"up"==a?this.gameObject.body.velocity.y=-this.speed:"down"==a&&(this.gameObject.body.velocity.y=this.speed),"left"==a?this.gameObject.body.velocity.x=-this.speed:"right"==a&&(this.gameObject.body.velocity.x=this.speed)}},app.Events={events:{},on:function(a,b){var c=this.events[a]||[];c.push(b),this.events[a]=c},trigger:function(a,b){var c=this.events[a];!c||c.length<1||[].forEach.call(c,function(a){a(b)})}},app.Views.InitialView=function(a){this.game=a,this.controller=null,this.isoGroup=null,this.water=[],this.gameBounds={height:2048,width:1024}},app.Views.InitialView.prototype={preload:function(){this.game.time.advancedTiming=!0,this.game.debug.renderShadow=!1,this.game.stage.disableVisibilityChange=!0;var a=new Phaser.Plugin.Isometric(this.game);this.game.plugins.add(a),this.loadAssets(),this.game.world.setBounds(0,0,this.gameBounds.height,this.gameBounds.width),this.game.physics.startSystem(Phaser.Plugin.Isometric.ISOARCADE),this.game.iso.anchor.setTo(.5,.1)},create:function(){this.controller=app.Controller.init(this.game),this.isoGroup=this.game.add.group(),this.isoGroup.enableBody=!0,this.isoGroup.physicsBodyType=Phaser.Plugin.Isometric.ISOARCADE,this.game.physics.isoArcade.gravity.setTo(0,0,-500),this.createTiles(),this.player=app.Player.init(this.game,this.isoGroup),this.game.camera.follow(this.player)},update:function(){var a=this.isoGroup,b=this.game;b.iso.unproject(b.input.activePointer.position,this.controller.cursorPos),this.controller.checkInputs(),b.physics.isoArcade.collide(a),b.iso.simpleSort(a)},render:function(){var a=this.game;a.debug.text("Infinite Frontier - Alpha Build",2,a.world.length-100,"#000000"),a.debug.text(a.time.fps||"--",2,14,"#a7aebe"),a.debug.text(Phaser.VERSION,2,a.world.height-2,"#ffff00")},loadAssets:function(){this.game.load.image("cube","/assets/cube.png"),this.game.load.atlasJSONHash("tileset","/assets/tileset.png","/assets/tileset.json"),this.game.load.atlasJSONHash("character","/assets/character.png","/assets/character.json")},generateRandomMap:function(a){for(var b=[],c=this.gameBounds.height/app.Constants.TILE_WIDTH,d=this.gameBounds.width/app.Constants.TILE_WIDTH,e=0;c>e;e++)for(var f=0;d>f;f++){var g=Math.floor(Math.random()*a.length);b.push(g)}return b},createTiles:function(){for(var a,b=["grass","bush1","bush2","mushroom"],c=this.generateRandomMap(b),d=app.Constants.TILE_WIDTH,e=0,f=this.game.physics.isoArcade.bounds.frontY-d,g=this.game.physics.isoArcade.bounds.frontX-d,h=d;f>=h;h+=d)for(var i=d;g>=i;i+=d)a=this.game.add.isoSprite(i,h,0,"tileset",b[c[e]],this.isoGroup),a.anchor.set(.5,1),a.smoothed=!1,a.body.moves=!1,e++},animateWater:function(){this.water.forEach(function(a){a.isoZ=-2*Math.sin(.004*(this.game.time.now+7*a.isoX))+-1*Math.sin(.005*(this.game.time.now+8*a.isoY)),a.alpha=Phaser.Math.clamp(1+.1*a.isoZ,.2,1)}.bind(this))},checkMouse:function(){var a=this.controller.cursorPos;this.isoGroup.forEach(function(b){var c=b.isoBounds.containsXY(a.x,a.y);!b.selected&&c?(b.selected=!0,b.originalIsoZ=b.isoZ,b.tint=8830938,this.game.add.tween(b).to({isoZ:b.isoZ+4},200,Phaser.Easing.Quadratic.InOut,!0)):b.selected&&!c&&(b.selected=!1,b.tint=16777215,this.game.add.tween(b).to({isoZ:b.originalIsoZ},200,Phaser.Easing.Quadratic.InOut,!0))})}},app.Game={game:null,init:function(){this.game=new Phaser.Game(window.screen.availWidth,window.screen.availHeight,Phaser.AUTO,"test",null,!0,!1),this.addGameStates(),this.startGame()},addGameStates:function(){var a=new app.Views.InitialView(this.game);this.game.state.add("start",a)},startGame:function(){this.game.state.start("start")}},app.Game.init();